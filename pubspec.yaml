name: library_scanner_domain
description: The domain layer for the library scanner app.
version: 2.1.2
# repository: https://github.com/my_org/my_repo
publish_to: none

environment:
  sdk: ">=3.10.0-0 <4.0.0"

# Add regular dependencies here.
dependencies:
  melos: ^7.4.0

workspace:
  - packages/core
  - packages/datastore_sembast
  - packages/datastore_hive
  - packages/domain_entities
  - packages/domain_usecases
  - packages/domain_contracts
  - packages/dataservice_filtering
  - packages/datastore_files

# Thanks to flutterfire for the start.
melos:
  name: electrical_junctions_domain
  repository: https://github.com/staylorx/electrical_junctions_domain

  packages:
    - packages/**
    - tests

  command:
    bootstrap:
      runPubGetInParallel: true
      usePubspecOverrides: true

  scripts:
    run_cli:
      run: dart run insurance_cli
      description: Run the custom CLI tool
      scope: packages/insurance_cli # Optional: filter to just this package
    # Example for running a command in all packages
    analyze_all:
      run: dart analyze .
      description: Run dart analyze in all packages

    lint:all:
      run: melos run analyze-ci && melos run format-ci
      description: Run all static analysis checks.

    analyze-ci:
      # We are setting the concurrency to 1 because a higher concurrency can crash
      # the analysis server on low performance machines (like GitHub Actions).
      run: |
        melos exec -c 1 --           dart analyze . --fatal-infos
      description: |
        Run `dart analyze` in all packages.
        - Note: you can also rely on your IDEs Dart Analysis / Issues window.

    format-ci:
      run: |
        melos exec -- dart format .
      description: |
        Formats the Dart code of all packages.

    test:
      run: |
        melos exec -c 6 --fail-fast --           "dart test"
      description: Run `dart test` for packages with test directory.
      packageFilters:
        dirExists:
          - test

    test:all:
      run: melos run test --no-select
      description: Run all tests across packages.

    coverage:
      run: |
        melos exec --           dart test --coverage=coverage
      description: Generate test coverage reports.
      packageFilters:
        dirExists:
          - test

    docs:
      run: |
        melos exec --           dart doc
      description: Generate Dart documentation for all packages.
      packageFilters:
        dirExists:
          - lib

    build:
      run: |
        melos exec -- dart compile exe bin/*.dart
      description: Build executables for packages with bin directories.
      packageFilters:
        dirExists:
          - bin

    clean:deep:
      run: git clean -x -d -f -q
      description: Clean things very deeply, can be used to establish "pristine checkout" status.

    qualitycheck:
      run: |
        melos run clean:deep &&         melos clean &&         melos bootstrap &&         melos run lint:all &&         melos run test:all
      description: Run all targets generally expected in CI for a full local quality check.
